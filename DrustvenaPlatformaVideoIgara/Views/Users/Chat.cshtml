@model DrustvenaPlatformaVideoIgara.Models.User

@{
    ViewData["Title"] = "Chat";
    var friends = Model.FriendUserId1Navigations
        .Select(f => f.UserId2Navigation)
        .Union(Model.FriendUserId2Navigations.Select(f => f.UserId1Navigation))
        .ToList();
}

<div class="chat-container">
    <div class="friend-list">
        <h4 class="text-light">Friends List</h4>
        <label for="recipientUserId" class="form-label text-light">Recipient</label>
        <div class="input-group">
            <select id="recipientUserId" class="form-select">
                <option value="" data-image="" selected>Select a friend</option>
                @foreach (var friend in friends)
                {
                    <option value="@friend.UserId" data-image="@friend.ProfilePicture">@friend.NickName</option>
                }
            </select>
        </div>
    </div>
    <div class="chat-area">
        <div class="message-controls mb-2">
            <label for="messageInput" class="form-label text-light">Message</label>
            <input type="text" class="form-control" id="messageInput" />
            <button type="button" id="sendButton" class="btn btn-primary mt-2">Send Message</button>
        </div>
        <hr class="text-light" />
        <ul id="messagesList" class="list-group"></ul>
    </div>
    <input type="hidden" id="nickName" value="@ViewBag.NickName" />
</div>

<script src="~/lib/microsoft/signalr/dist/browser/signalr.js"></script>
<script src="~/js/chat.js"></script>


<style>
    .chat-container {
        display: flex;
        height: auto; /* height of the viewport */
    }

    .friend-list {
        width: 40%;
        background-color: #333;
        padding: 15px;
        border-radius: 10px;
        overflow-y: auto; /* Adds scroll if content exceeds container height */
    }

    .chat-area {
        width: 60%;
        background-color: #444;
        padding: 15px;
        border-radius: 10px;
        display: flex;
        flex-direction: column;
    }

    .message-controls {
        flex-shrink: 0; /* Prevents the message controls from shrinking */
    }

    #messagesList {
        flex: 1; /* Takes up remaining space in the chat area */
        max-height: 400px; /* Ensures the chat history doesn't exceed this height */
        overflow-y: auto; /* Adds scroll if content exceeds max-height */
        overflow-x: hidden; /* Prevents horizontal scrolling */
    }

    .form-label {
        color: #e5e5e5;
    }

    .btn-primary {
        background-color: #5bc0de;
        border: none;
    }

        .btn-primary:hover {
            background-color: #4a9fd4;
        }

    .list-group {
        margin-bottom: 0; /* Remove bottom margin to align with chat area */
    }

    .list-group-item {
        background-color: #333;
        border: none;
        color: #e5e5e5;
        margin-bottom: 5px;
        border-radius: 5px;
        display: flex;
        align-items: center;
        padding: 10px;
    }

        /* .list-group-item:nth-child(even) {
            background-color: #444;
        } */

        .list-group-item img {
            width: fit-content;
            height: 80px;
            /* border-radius: 50%; */
            object-fit: cover;
            margin-right: 10px;
        }

    .message-header {
        display: flex;
        align-items: center;
    }

        .message-header .nickname {
            font-weight: bold;
            margin-right: 10px;
        }

    .message-content {
        margin: 0;
        flex: 1;
        word-wrap: break-word;
        word-break: break-word;
    }

    .message-timestamp {
        font-size: 0.8rem;
        color: #bbb;
        margin-top: 3px;
    }
</style>
