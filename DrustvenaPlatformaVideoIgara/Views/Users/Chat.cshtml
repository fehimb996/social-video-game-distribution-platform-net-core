@model DrustvenaPlatformaVideoIgara.Models.User

@{
    ViewData["Title"] = "Chat";
    var friends = Model.FriendUserId1Navigations
        .Select(f => f.UserId2Navigation)
        .Union(Model.FriendUserId2Navigations.Select(f => f.UserId1Navigation))
        .ToList();
}

<style>
    .chat-container {
        display: flex;
        height: 80vh; /* Full viewport height */
    }

    .friend-list {
        width: 40%;
        background-color: #333;
        padding: 15px;
        border-radius: 10px;
        overflow-y: auto;
        max-height: 80vh; /* Maximum height of the viewport */
        box-sizing: border-box; /* Include padding in the height calculation */
    }

    .chat-area {
        width: 60%;
        background-color: #444;
        padding: 15px;
        border-radius: 10px;
        display: flex;
        flex-direction: column;
    }

    #messagesList {
        flex: 1;
        max-height: 400px;
        overflow-y: auto;
        overflow-x: hidden;
        margin-bottom: 10px; /* Space between message list and input controls */
    }

    .message-controls {
        flex-shrink: 0;
    }

    .form-label {
        color: #e5e5e5;
    }

    .btn-primary {
        background-color: #5bc0de;
        border: none;
    }

        .btn-primary:hover {
            background-color: #4a9fd4;
        }

    .list-group {
        margin-bottom: 0;
    }

    .list-group-item {
        background-color: #333;
        border: none;
        color: #e5e5e5;
        margin-bottom: 5px;
        border-radius: 5px;
        display: flex;
        align-items: center;
        padding: 10px;
        cursor: pointer;
    }

        .list-group-item img {
            width: 50px; /* Adjusted size for profile picture */
            height: 50px;
            object-fit: cover;
            margin-right: 10px;
            border-radius: 50%;
        }

        .list-group-item.selected {
            background-color: #555; /* Highlight selected friend */
        }

    .message-header {
        display: flex;
        align-items: center;
    }

        .message-header .nickname {
            font-weight: bold;
            margin-right: 10px;
        }

    .message-content {
        margin: 0;
        flex: 1;
        word-wrap: break-word;
        word-break: break-word;
    }

    .message-timestamp {
        font-size: 0.8rem;
        color: #bbb;
        margin-top: 3px;
    }
</style>

<div class="chat-container">
    <div class="friend-list">
        <h4 class="text-light">Friends List</h4>
        <div id="friendsList">
            @foreach (var friend in friends)
            {
                <div class="list-group-item" data-user-id="@friend.UserId" data-image="@friend.ProfilePicture">
                    <img src="@friend.ProfilePicture" alt="@friend.NickName's profile picture">
                    <span>@friend.NickName</span>
                </div>
            }
        </div>
    </div>
    <div class="chat-area">
        <ul id="messagesList" class="list-group"></ul>
        <div class="message-controls">
            <label for="messageInput" class="form-label text-light">Message</label>
            <textarea class="form-control" id="messageInput" rows="3"></textarea>
            <button type="button" id="sendButton" class="btn btn-success text-white mt-2">Send Message</button>
        </div>
    </div>
    <input type="hidden" id="nickName" value="@ViewBag.NickName" />
</div>

<script src="~/lib/microsoft/signalr/dist/browser/signalr.js"></script>
<script src="~/js/chat.js"></script>
